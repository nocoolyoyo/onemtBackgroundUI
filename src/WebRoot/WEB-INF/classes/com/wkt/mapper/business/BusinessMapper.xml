<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.wkt.dao.business.IBusinessDao">
	<select id="findBusinessById" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		SELECT t.*,u.title unitname FROM yj_business t,yj_business_unit u WHERE 1=1 and t.unit_id=u.id
		<if test="unit_id!=null and unit_id!=''">
			and t.unit_id=#{unit_id}
		</if>
		<if test="state!=null and state!=''">
		 	and t.state in(${state}) 
		</if>
		<if test="status!=null and status!=''">
			AND t.status = #{status}
		</if>
		<if test="title!=null and title!=''">
			AND t.title like '%${title}%'
		</if>
		<if test="start_time!=null and start_time!=''">
			AND t.create_time >= #{start_time}
		</if>
		<if test="end_time!=null and end_time!=''">
			<![CDATA[ AND t.create_time <= #{end_time} ]]> 
		</if>
		<if test="ustart_time!=null and ustart_time!=''">
			AND t.update_time >= #{ustart_time}
		</if>
		<if test="uend_time!=null and uend_time!=''">
			<![CDATA[ AND t.update_time <= #{uend_time} ]]> 
		</if>
		<if test="unitid !=null and unitid !=''">
			AND t.unit_id = #{unitid}
		</if>
		ORDER BY t.update_time desc,t.create_time DESC
		<if test="y != null and y != '' and y != 0">
			LIMIT ${x},${y}
		</if>
	</select>

	<insert id="insertBusiness" parameterType="java.util.HashMap" useGeneratedKeys="true" keyProperty="id">
		INSERT INTO yj_business(title, create_time, unit_id,unit_name, area,update_time,
		industry,type,money,contact,phone,address,file_id,status,unit_avatar,unit_profile,state,operate_user_id
		<if test="operate_user_name !=null and operate_user_name !=''">
			,operate_user_name
		</if>)
		VALUE
		(#{title},#{create_time},#{unit_id},#{unit_name},#{area},#{create_time},
		#{industry},#{type},#{money},#{contact},#{phone},#{address},#{file_id},1,#{unit_avatar},#{unit_profile},#{state},#{operate_user_id}
		<if test="operate_user_name !=null and operate_user_name !=''">
			,#{operate_user_name}
		</if>)
	</insert>

	<update id="deleteBusinessById" parameterType="java.util.HashMap">
		update yj_business
		set update_time = #{update_time},
			update_id=#{update_id},
			update_type = 2
		<if test="update_name !=null and update_name !=''">
			,update_name=#{update_name}
		</if>
		<if test="state!=null and state!=''">
			,state=#{state}
		</if>
		<if test="status!=null and status!=''">
			,status = #{status}
		</if>
		where id=#{id}
	</update>

	<update id="updateBusinessById" parameterType="java.util.HashMap">
		update yj_business set update_time = #{update_time},
		<if test="audit_time !=null and audit_time !=''">
			audit_time = #{audit_time},
		</if>
			update_id=#{update_id}
		<if test="update_name !=null and update_name !=''">
			,update_name = #{update_name}
		</if>
		<if test="area!=null and area!=''">
			,area=#{area}
		</if>
		<if test="industry!=null and industry!=''">
			,industry=#{industry}
		</if>
		<if test="type!=null and type!=''">
			,type=#{type}
		</if>
		<if test="money!=null and money!=''">
			,money=#{money}
		</if>
		<if test="contact!=null">
			,contact=#{contact}
		</if>
		<if test="phone!=null">
			,phone=#{phone}
		</if>
		<if test="address!=null">
			,address=#{address}
		</if>
		<if test="file_id!=null">
			,file_id=#{file_id}
		</if>
		<if test="title!=null and title!=''">
			,title=#{title}
		</if>
		<if test="state!=null and state!=''">
			,state=#{state}
		</if>
		<if test="status!=null and status!=''">
			,status = #{status}
		</if>
		<if test="audit_opinion !=null and audit_opinion !=''">
			,audit_opinion = #{audit_opinion}
		</if>
		<if test="audit_user_name !=null and audit_user_name !=''">
			,audit_user_name = #{audit_user_name}
		</if>
		<if test="audit_user_id !=null and audit_user_id !=''">
			,audit_user_id = #{audit_user_id}
		</if>
		where id=#{id}
	</update>

	<select id="getBusinessById" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		select s.*,u.title unitname from yj_business s,yj_business_unit u where s.id=#{id} and s.unit_id=u.id
		<!-- select s.* from yj_business s where s.id=#{id} -->
	</select>

	<select id="getBusinessUnitById" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		select * from yj_business_unit where id=#{id}
	</select>

	<update id="updateBusinessUnitById" parameterType="java.util.HashMap">
		UPDATE yj_business_unit set update_time=#{update_time}
		<if test="status!=null and status!=''">
			,status=#{status}
		</if>
		<if test="title!=null and title!=''">
			,title=#{title}
		</if>
		<if test="avatar!=null">
			,avatar=#{avatar}
		</if>
		<if test="profile!=null">
			,profile=#{profile}
		</if>
		<if test="address!=null and address!=''">
			,address = #{address}
		</if>
		<if test="phone!=null and phone!=''">
			,phone = #{phone}
		</if>
		<if test="username!=null and username!=''">
			,username = #{username}
		</if>
		<if test="password!=null and password!=''">
			,password=#{password}
		</if>
			,update_user =#{user_id}
			where id= #{id}
	</update>
	
	<select id="countBusinessById"  parameterType="java.util.HashMap" resultType="Integer">
		SELECT count(*) FROM yj_business t,yj_business_unit u WHERE 1=1 and t.unit_id=u.id
		<if test="unit_id!=null and unit_id!=''">
			and t.unit_id=#{unit_id}
		</if>
		<if test="state!=null and state!=''">
		 	and t.state in(${state})
		</if>
		<if test="status!=null and status!=''">
			AND t.status = #{status}
		</if>
		<if test="title!=null and title!=''">
			AND t.title like '%${title}%'
		</if>
		<if test="start_time!=null and start_time!=''">
			AND t.create_time >= #{start_time}
		</if>
		<if test="end_time!=null and end_time!=''">
			<![CDATA[ AND t.create_time <= #{end_time} ]]> 
		</if>
		<if test="ustart_time!=null and ustart_time!=''">
			AND t.update_time >= #{ustart_time}
		</if>
		<if test="uend_time!=null and uend_time!=''">
			<![CDATA[ AND t.update_time <= #{uend_time} ]]> 
		</if>
		<if test="unitid !=null and unitid !=''">
			AND t.unit_id = #{unitid}
		</if>
	</select>
	
	<insert id="insertBusinessUnit" parameterType="java.util.HashMap">
		insert into yj_business_unit(title,avatar,profile,address,phone,username,password,status,create_time,create_user)
		value(#{title},#{avatar},#{profile},#{address},#{phone},#{username},#{password},#{status},#{create_time},#{create_user})
	</insert>
	
	<select id="findBusinessUnit" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		SELECT id,title,avatar,profile,address,phone,username,status,create_time,create_user,update_time,update_user FROM yj_business_unit
		where 1=1
		<if test="status!=null and status!=''">
			and status=#{status}
		</if>
		<if test="title!=null and title!=''">
			and title like '%${title}%'
		</if>
		<if test="start_time!=null and start_time!=''">
			AND create_time >= #{start_time}
		</if>
		<if test="end_time!=null and end_time!=''">
			<![CDATA[ AND create_time <= #{end_time} ]]> 
		</if>
		ORDER BY create_time DESC
		<if test="y != null and y != '' and y != 0">
			LIMIT ${x},${y}
		</if>
	</select>
	
	<select id="countBusinessUnit" parameterType="java.util.HashMap" resultType="Integer">
		SELECT count(*) FROM yj_business_unit
		where 1=1
		<if test="status!=null and status!=''">
			and status=#{status}
		</if>
		<if test="title!=null and title!=''">
			and title like '%${title}%'
		</if>
		<if test="start_time!=null and start_time!=''">
			AND create_time >= #{start_time}
		</if>
		<if test="end_time!=null and end_time!=''">
			<![CDATA[ AND create_time <= #{end_time} ]]> 
		</if>
	</select>
	<!-- 验证招商单位账户名是否重复 -->
	<select id="checkUnitUsername" parameterType="java.util.HashMap" resultType="Integer">
		SELECT count(*) FROM yj_business_unit
		where username = #{username}
		<if test="id !=null and id !=''">
			and id!=#{id}
		</if>
	</select>
	
	<!-- 获取关注招商单位的用户 -->
	<select id="findBusinessUserInfo" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		SELECT
			p.*
		FROM
			PRE_AL_MEMBER p,
			yj_common_follow t
		WHERE
			p.USID = t.user_id
		AND t.obj_type = #{obj_type}
		AND obj_id = #{obj_id}
		AND `status` = 1
	</select>
	
</mapper>