<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.wkt.dao.association.IArticleAssociationDao">
	
	<insert id="insertArticleAssociation" parameterType="java.util.HashMap" >
	 	INSERT INTO yj_article_association(obj_id,obj_type,title,create_id,create_name,create_time,update_time,create_type,status,state)VALUE(#{obj_id},#{obj_type},#{title},#{user_id},#{user_name},#{create_time},#{create_time},#{create_type},1,#{state})
	</insert>
	
	<update id="updateArticleAssociation" parameterType="java.util.HashMap">
		update yj_article_association set update_time=#{update_time}
		<if test="status!=null and status!='' ">
		 	,status=#{status}
		 </if>
		 <if test="state!=null and state!=''">
		 	,state = #{state}
		 </if>
		<if test="update_id !=null and update_id !='' ">
		 	,update_id=#{update_id}
		 </if>
		 <if test="update_name !=null and update_name !=''">
		 	,update_name = #{update_name}
		 </if>
		<if test="audit_user_id !=null and audit_user_id !='' ">
		 	,audit_user_id=#{audit_user_id}
		 </if>
		 <if test="audit_user_name !=null and audit_user_name !=''">
		 	,audit_user_name = #{audit_user_name}
		 </if>
		 <if test="audit_time !=null and audit_time !=''">
		 	,audit_time = #{audit_time}
		 </if>
		 <if test="title!=null and title!=''">
		 	,title = #{title}
		 </if>
		  where 1=1 <!-- id=#{id} -->
		    and obj_id=#{obj_id}
		    and obj_type=#{obj_type}
	</update>
	
	<!-- 审核文章内容 -->
	<update id="auditArticleAssociation" parameterType="java.util.HashMap">
		update yj_article_association set update_time=#{update_time}
		<if test="status!=null and status!='' ">
		 	,status=#{status}
		 </if>
		 <if test="state!=null and state!=''">
		 	,state = #{state}
		 </if>
		<if test="update_id !=null and update_id !='' ">
		 	,update_id=#{update_id}
		 </if>
		 <if test="update_name !=null and update_name !=''">
		 	,update_name = #{update_name}
		 </if>
		<if test="audit_user_id !=null and audit_user_id !='' ">
		 	,audit_user_id=#{audit_user_id}
		 </if>
		 <if test="audit_user_name !=null and audit_user_name !=''">
		 	,audit_user_name = #{audit_user_name}
		 </if>
		 <if test="audit_time !=null and audit_time !=''">
		 	,audit_time = #{audit_time}
		 </if>
		 <if test="title!=null and title!=''">
		 	,title = #{title}
		 </if>
		  where 1=1 <!-- id=#{id} -->
		    and obj_id=#{obj_id}
		    and obj_type=#{obj_type}
	</update>
	
	<select id="findArticleAssociation" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		select * from yj_article_association where 1=1
		<if test="status!=null and status!=''">
			and	status = #{status}
		</if>
		<if test="state!=null and state!=''">
			and state =#{state}
		</if>
		<if test="title!=null and title!=''">
			and title like '%${title}%'
		</if>
		<if test="obj_type!=null and obj_type!=''">
			and obj_type =#{obj_type}
		</if>
		<if test="start_time!=null and start_time!=''">
			and create_time >=#{start_time}
		</if>
		<if test="end_time!=null and end_time!=''">
			<![CDATA[ and create_time <=#{end_time} ]]> 
		</if>
		<if test="ustart_time!=null and ustart_time!=''">
			and update_time >=#{ustart_time}
		</if>
		<if test="uend_time!=null and uend_time!=''">
			<![CDATA[ and update_time <=#{uend_time} ]]> 
		</if>
		<if test="astart_time!=null and astart_time!=''">
			and audit_time >=#{astart_time}
		</if>
		<if test="aend_time!=null and aend_time!=''">
			<![CDATA[ and audit_time <=#{aend_time} ]]> 
		</if>
		ORDER BY update_time desc
		<if test="y != null and y != ''">
			LIMIT ${x},${y}
		</if>
	</select>
	
	<select id="countArticleAssociation" parameterType="java.util.HashMap" resultType="Integer">
		select count(*) from yj_article_association where 1=1 
		<if test="status!=null and status!=''">
			and	status = #{status}
		</if>
		<if test="title!=null and title!=''">
			and title like '%${title}%'
		</if>
		<if test="state!=null and state!=''">
			and state =#{state}
		</if>
		<if test="obj_type!=null and obj_type!=''">
			and obj_type =#{obj_type}
		</if>
		<if test="start_time!=null and start_time!=''">
			and create_time >=#{start_time}
		</if>
		<if test="end_time!=null and end_time!=''">
			<![CDATA[ and create_time <=#{end_time} ]]> 
		</if>
		<if test="ustart_time!=null and ustart_time!=''">
			and update_time >=#{ustart_time}
		</if>
		<if test="uend_time!=null and uend_time!=''">
			<![CDATA[ and update_time <=#{uend_time} ]]> 
		</if>
		<if test="astart_time!=null and astart_time!=''">
			and audit_time >=#{astart_time}
		</if>
		<if test="aend_time!=null and aend_time!=''">
			<![CDATA[ and audit_time <=#{aend_time} ]]> 
		</if>
	</select>
	
	<!-- 查询是否大置顶冲突 -->
	<select id="checkBigTop" parameterType="java.util.HashMap" resultType="Integer">
		select count(*) from yj_feed_filter_tmp t,yj_feed s 
		 where t.type=2 and t.feed_id=s.id AND s.`status` = 1
		   and(( t.end_time >=#{start_time} 
		   <![CDATA[ and t.start_time <#{start_time} ]]>) 
		   or(t.end_time >=#{end_time}
		    <![CDATA[ and t.start_time <#{end_time} ]]> ) )
		<if test="big_time_id!=null and big_time_id!=''">
			and t.feed_id!=#{big_time_id}
		</if>
	</select>
	
	<!-- 查询大置顶 -->
	<select id="fidBigTopLists" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		select t.*,s.title from yj_feed_filter_tmp t,yj_feed s 
		 where t.type=2 and t.feed_id=s.id
		   and(( t.end_time >=#{start_time} 
		   <![CDATA[ and t.start_time <=#{start_time} ]]>) 
		   or(t.end_time >=#{end_time}
		    <![CDATA[ and t.start_time <=#{end_time} ]]> ) )
	</select>
	
	<!-- 查询大置顶 -->
	<update id="updateBigTopInfo" parameterType="java.util.HashMap">
		update yj_feed_filter_tmp
		set start_time=#{start_time}
		   ,end_time=#{start_time}
		  where id=#{id}
	</update>
	
	<!-- 查询额外推送信息 -->
	<select id="findFeedInfo" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		select * from yj_feed_temp_feedinfo t where t.id=#{feed_info_id}
	</select>
	
	<!-- 查询置顶 时间-->
	<select id="findFeedTimeInfo" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		select * from yj_feed_filter_tmp t 
		 where t.feed_id=#{feed_id} 
		   and t.type=#{top_type}
		   and t.obj_id=#{obj_id}
		   and t.obj_type=#{obj_type}
	</select>
	
	<!-- 查询文章对应信息流信息 -->
	<select id="findFeedInfoByObjidAndObjtype" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		select * from yj_feed_temp_feedinfo t where t.is_push_again=1 
		<if test="is_push_type!=null and is_push_type!=''">
			and  is_push_type=#{is_push_type} 
		</if>
		and t.obj_id=#{obj_id} and t.obj_type=#{obj_type};
	</select>
</mapper>